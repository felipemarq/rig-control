// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UF {
  AC
  AL
  AM
  AP
  BA
  CE
  DF
  ES
  GO
  MA
  MG
  MS
  MT
  PA
  PB
  PE
  PI
  PR
  RJ
  RN
  RO
  RR
  RS
  SC
  SE
  SP
  TO
}

model Rig {
  id                   String                 @id @default(uuid()) @db.Uuid
  name                 String                 @unique
  isActive             Boolean                @default(true)
  state                UF
  users                UserRig[]
  efficiencies         Efficiency[]
  BillingConfiguration BillingConfiguration[]
  Billing              Billing[]

  @@map("rigs")
}

enum AccessLevel {
  ADM
  USER

  @@map("access_level")
}

model User {
  id          String      @id @default(uuid()) @db.Uuid
  name        String
  email       String      @unique
  password    String
  accessLevel AccessLevel @map("access_level")

  rigs         UserRig[]
  efficiencies Efficiency[]

  @@map("users")
}

model UserRig {
  userId String @map("user_id") @db.Uuid
  rigId  String @map("rig_id") @db.Uuid

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  rig  Rig  @relation(fields: [rigId], references: [id], onDelete: Cascade)

  @@id([userId, rigId])
  @@map("users_rigs")
}

model Efficiency {
  id             String   @id @default(uuid()) @db.Uuid
  date           DateTime
  availableHours Float    @map("available_hours")
  rigId          String   @map("rig_id") @db.Uuid
  userId         String   @map("user_id") @db.Uuid

  rig            Rig              @relation(fields: [rigId], references: [id])
  user           User             @relation(fields: [userId], references: [id])
  periods        Period[]
  fluidRatio     FluidRatio[]
  equipmentRatio EquipmentRatio[]
  Billing        Billing[]

  @@map("efficiencies")
}

enum PeriodType {
  GLOSS
  REPAIR
  DTM
  WORKING

  @@map("period_type")
}

enum PeriodClassification {
  WORKING
  LABOR
  PROCESS
  LOGISTICS
  SECURITY
  RIG_CAR
  MAST
  RIG_WINCH
  RIG_TRANSMISSION
  UCI
  MUD_TANK
  TRAILER
  MUD_BOMB
  PIPE_RACK
  BOP
  CHOKE_MANIFOLD
  HOSES
  HYDRAULIC_WRENCH
  HANDLING_TOOLS
  LT20
  BT20AND50
  GT50
  OTHERS
}

model Period {
  id             String               @id @default(uuid()) @db.Uuid
  startHour      DateTime             @map("start_hour")
  endHour        DateTime             @map("end_hour")
  classification PeriodClassification
  description    String?
  type           PeriodType
  efficiencyId   String               @map("efficiency_id") @db.Uuid

  efficiency Efficiency @relation(fields: [efficiencyId], references: [id], onDelete: Cascade)

  @@map("periods")
}

enum Interval {
  LT20
  BT20AND50
  GT50
}

model FluidRatio {
  id           String   @id @default(uuid()) @db.Uuid
  ratio        Interval
  efficiencyId String   @map("efficiency_id") @db.Uuid

  efficiency Efficiency @relation(fields: [efficiencyId], references: [id], onDelete: Cascade)

  @@map("fluid_ratio")
}

model EquipmentRatio {
  id           String     @id @default(uuid()) @db.Uuid
  ratio        Interval
  efficiencyId String     @map("efficiency_id") @db.Uuid
  efficiency   Efficiency @relation(fields: [efficiencyId], references: [id], onDelete: Cascade)

  @@map("equipment_ratio")
}

model BillingConfiguration {
  id                         String @id @default(uuid()) @db.Uuid
  rigId                      String @map("rig_id") @db.Uuid
  availableHourTax           Float  @map("available_hour_tax")
  glossHourTax               Float  @map("gloss_hour_tax")
  dtmLt20Tax                 Float  @map("dtm_lt_20_tax")
  dtmBt20And50Tax            Float  @map("dtm_bt_20_and_50_tax")
  dtmGt50Tax                 Float  @map("dtm_gt_50_tax")
  fluidRatioLt20Tax          Float  @map("fluid_ratio_lt_20_tax")
  fluidRatioBt20And50Tax     Float  @map("fluid_ratio_bt_20_and_50_tax")
  fluidRatioGt50Tax          Float  @map("fluid_ratio_gt_50_tax")
  equipmentRatioLt20Tax      Float  @map("equipment_ratio_lt_20_tax")
  equipmentRatioBt20And50Tax Float  @map("equipment_ratio_bt_20_and_50_tax")
  equipmentRatioGt50Tax      Float  @map("equipment_ratio_gt_50_tax")
  readjustment               Float
  mobilization               Float

  rig Rig @relation(fields: [rigId], references: [id])

  @@map("billing_configurations")
}

model Billing {
  id                       String   @id @default(uuid()) @db.Uuid
  rigId                    String   @map("rig_id") @db.Uuid
  efficiencyId             String   @map("efficiency_id") @db.Uuid
  availableHourAmount      Float    @map("available_hour_amount")
  glossHourAmount          Float    @map("gloss_hour_amount")
  dtmLt20Amount            Float    @map("dtm_lt_20_amount")
  dtmBt20And50Amount       Float    @map("dtm_bt_20_and_50_amount")
  dtmGt50Amount            Float    @map("dtm_gt_50_amount")
  fluidLt20Amount          Float    @map("fluid_lt_20_amount")
  fluidBt20And50Amount     Float    @map("fluid_bt_20_and_50_amount")
  fluidGt50Amount          Float    @map("fluid_gt_50_amount")
  equipmentLt20Amount      Float    @map("equipment_lt_20_amount")
  equipmentBt20And50Amount Float    @map("equipment_bt_20_and_50_amount")
  equipmentGt50Amount      Float    @map("equipment_gt_50_amount")
  date                     DateTime
  total                    Float

  rig        Rig        @relation(fields: [rigId], references: [id], onDelete: Cascade)
  efficiency Efficiency @relation(fields: [efficiencyId], references: [id], onDelete: Cascade)

  @@map("billings")
}
